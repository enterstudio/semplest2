<project name="SemplestService" default="build-installer" basedir="..">

   <!-- artifactsDir and buildVersion passed in for the build machine-->
	<property environment="env"/>
	<property name="product.version" value="${env.BUILD_VERSION}"/>
   <!--	switch when build locally
   <property name="product.version" value="1.0.x"/>  -->
	
	 <condition property="output.dir" value="${artifactsDir}" 
	             else="${basedir}">
	    <isset property="artifactsDir"/>
	  </condition>

  <property name="build" value="${basedir}/build"/>  
  <property file="${build}/build.properties"/>       
  <property name="lib" value="${basedir}/dist/lib"/>
  <property name="keys" value="${basedir}/keys"/>
  <property name="properties" value="${basedir}/properties"/>
  <property name="source" value="${basedir}/src"/>   
  <property name="dist" value="${basedir}/dist"/>  
  <property name="classes" value="${basedir}/classes"/>  
  <property name="docs" value="${basedir}/docs"/>    
  <property name="javadoc" value="${docs}/api"/>     
  <property name="test.dir" value="${basedir}/test"/>
  <property name="java.debug" value="true"/>
   
<!-- IZPACK Stuff -->
  <property file="${basedir}/src/system.properties"/>
  <property name="product.name" value="SemplestService"/>
  <property name="product.short.name" value="SemplestService"/>
  <property name="default.dest.dir" value="C:/workspace/SemplestService"/>
 	
  <property name="install.builder.dir" value="${basedir}/../izpack"/>            
  <property name="install.ant" value="${install.builder.dir}/ant"/>            
  <property name="install.lib" value="${install.builder.dir}/lib"/>            
  <property name="install.res" value="${install.builder.dir}/res"/>            
  <property name="install.xml" value="install-definition.xml"/>
  <property name="app.name" value="${product.name}"/>
  <property name="app.short.name" value="${product.short.name}"/>
  <property name="app.version" value="${product.version}"/>

  <property name="yajsw.dir" value="${basedir}/autoDeployFiles/YAJSW_11_0" />
	
  <property name="semplest.autoDeploy" value="${basedir}/autoDeployFiles" />
 
  <!-- Load semplest.service from system.properties -->
	<loadproperties srcFile="${basedir}/src/system.properties">
	      <filterchain>
	        <linecontains>
	          <contains value="semplest.service"/>
	        	<contains value="YAJSW.servicename"/>
	        </linecontains>
	      </filterchain>
	    </loadproperties>	
  
  <property name="semplest.protocol.dir" value="${basedir}/../SEMplestProtocol" />
  <property name="semplest.protocol.lib" value="${basedir}/../SEMplestProtocol/lib" />
	
  <property name="semplest.keywords.dir" value="${basedir}/../SemplestKeywords" />
  <property name="semplest.keywords.lib" value="${basedir}/../SemplestKeywords/lib" />
	
  <property name="semplest.bidding.dir" value="${basedir}/../SEMplestBidding" />
  <property name="semplest.bidding.lib" value="${basedir}/../SEMplestBidding/lib" />	
	
  <property name="semplest.clientapi.dir" value="${basedir}/../SemplestServicesClient" />
  <property name="semplest.clientapi.lib" value="${basedir}/../SemplestServicesClient/lib" />
 	
  <property name="ant.contrib.dir" value="${basedir}/../ant-contrib" />
  <property name="install.root.local" value="${basedir}/build/install-root" />
	  
  <!-- Allows us to use the IzPack Ant task, standalone-compiler.jar added to Ant lib -->
  <!-- classpath="${basedir}/lib/standalone-compiler.jar" -->
  <taskdef name="izpack" classpath="${install.lib}/standalone-compiler.jar" 
	  classname="com.izforge.izpack.ant.IzPackTask"/>
 
	<target name="build-installer" description="Create distribution executable">

		<propertyregex property="service.name" input="${YAJSW.servicename}" 			
		    defaultvalue="Service" 
		    override="true"/>
	    <!-- Run installer build with install-definition -->
	    <echo message="Running IzPack to build the installer(s)..."/>  
	    <izpack input="${install.xml}"
	            output="${output.dir}/${product.short.name}-${service.name}-${product.version}-install.jar"
	            installerType="standard"
	            inheritAll="true"
	            basedir="${dist}"
	            compression="deflate"
	            compressionlevel="9"/>
	    <echo message="Done."/>  
	</target>
	  

</project>